Notes on setting up an EC2 instance.

Set up account with amazon AWS

referring to this:
http://paulstamatiou.com/how-to-getting-started-with-amazon-ec2


Create your X509 Certificate from the amazon security credentials interface in your account web interface

Download the Private Key and Cert, keep them safe

Downlaod the Amazon EC2 API Tools from amazon

create a folder to hold this stuff in your home directory like "ec2"
put the contents of the API tools folder in there
put the key and cert in there


Add ENV vars to your bash profile
export EC2_HOME=~/.ec2
export PATH=$PATH:$EC2_HOME/bin
export EC2_PRIVATE_KEY=pk-YOURKEYNAME.pem
export EC2_CERT=cert-YOURKEYNAME.pem
export JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Home/

hope you have java?


setup a key pair for ssh ing
ec2-add-keypair pstam-keypair
paste the contents of the private key into a new file "id_rsa-pstam-keypair"
for our eyes only:
sudo chmod 600 id_rsa-pstam-keypair


time to pick your AMI (server os image)
i'm going with the default linux
http://aws.amazon.com/amazon-linux-ami/
ami-1b814f72 US WEST

create the instance!!!
ec2-run-instances ami-1b814f72 -k pstam-keypair
it took like 10 seconds, crazy fast

show the instance info, including url
ec2-describe-instances


open a port for ssh, might as well get 80 for http as well
ec2-authorize default -p 22 
ec2-authorize default -p 80

http:// doesn't work… maybe no server on the AMI?


lets ssh in
ssh -i id_rsa-pstam-keypair root@ec2-XXX-XXX-XXX-XXX.z-2.compute-1.amazonaws.com

not working, popping up a password field, i don't have a password to give
looking at the web console. looks like i messed up the copy paste of the key be sure to get copy the start and end lines (the ones with the =====)

and then it wants me to use another user!

ssh -i id_rsa-pstam-keypair ec2-user@ec2-XXX-XXX-XXX-XXX.compute-1.amazonaws.com

it worked!!



lets look around!
ls /
ls /bin
ls /usr/bin
ls /usr/local/bin
ls /local/bin

hell yeah!




==============
lets install node on the ec2!!!

ssh in
cd /usr/local/src/

install git!
sudo yum install -y git

what else can i get with yum?
yum list available

lots of stuff, no node
lets do this from the source!
sudo git clone https://github.com/joyent/node.git

lets switch to the 0.6.13
cd node
sudo git checkout v0.6.13
./configure
uh oh no compilers!
yum install gcc gcc-c++ autoconf automake
gonna need ssl too
yum install openssl-devel
and, uh, make
yum install make

now try to make it
sudo make
sudo make install
hurray!

which node
yeah!
which npm
yeah yeah!


lets try it with an example server.
gotta sudo it

var http = require('http');
http.createServer(function (req, res) {
  res.writeHead(200, {'Content-Type': 'text/plain'});
  res.end('Hello World\n');
}).listen(80);
console.log('Server runnin at: 80');


then put that ec2-x-x-x-x…com url in to a browser and…
HELLO WORLD



lets see a silly bench
(function() {
  var n, start, sum;

  start = Date.now();

  sum = 0;

  for (n = 1; n <= 1000000000; n++) {
    sum += Math.sqrt(n);
  }

  console.log("sum of sqrts of the numbers 1 to 1 billion", sum);

  console.log("took", Date.now() - start);

}).call(this);

on my laptop:
sum of sqrts of the numbers 1 to 1 billion 21081851083600.56
took 10641

on ec2 micro:
sum of sqrts of the numbers 1 to 1 billion 21081851083600.56
took 24150

don't you want to try a big gun?



don't stop now
cd ~
npm install socket.io





this looks like a good reference, maybe i should have used before
http://codelikezell.com/setting-up-rails-mysql-php-apache-and-git-on-ec2/




